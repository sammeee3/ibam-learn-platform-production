<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); margin: 10px auto; max-width: 500px; width: 95%; text-align: center; font-family: Arial, sans-serif; box-sizing: border-box;">
    
    <div style="background: rgba(0,255,255,0.2); color: #0099cc; padding: 8px 16px; border-radius: 20px; font-size: 12px; margin-bottom: 20px; border: 1px solid rgba(0,255,255,0.3); font-weight: bold;">
        🚀 SEAMLESS URL PARAMETER
    </div>
    
    <h1 style="color: white; font-size: 28px; font-weight: bold; margin-bottom: 16px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
        🎯 Welcome to IBAM Learning Platform
    </h1>
    
    <p style="color: rgba(255,255,255,0.9); font-size: 18px; margin-bottom: 32px; line-height: 1.5;">
        Your faith-driven business mastery course is ready!
    </p>
    
    <div style="margin: 24px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 12px; border: 1px solid rgba(255,255,255,0.2);">
        <h3 style="color: white; margin: 0 0 12px 0; font-size: 18px;">📚 What You'll Access:</h3>
        <ul style="color: rgba(255,255,255,0.9); text-align: left; margin: 0; padding-left: 20px; line-height: 1.6;">
            <li>Complete IBAM Impact Member Training</li>
            <li>Interactive modules and assessments</li>
            <li>Business planning tools & templates</li>
            <li>AI-powered coaching assistance</li>
            <li>Progress tracking & certificates</li>
        </ul>
    </div>
    
    <button id="accessBtn" onclick="seamlessLogin()" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); color: white; border: none; padding: 18px 30px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 20px rgba(0,0,0,0.2); text-decoration: none; display: inline-block; min-width: 220px; width: 90%; max-width: 300px; touch-action: manipulation;">
        <span style="margin-right: 12px; font-size: 24px;">🚀</span>
        <span>Access Your Course Now</span>
    </button>
    
    <div style="margin-top: 24px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 4px solid #4ecdc4;">
        <p style="color: white; margin: 0; font-size: 14px; font-weight: bold;">🚀 Seamless Integration:</p>
        <p style="color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 13px; line-height: 1.4;">
            Automatic login using URL parameter from System.io. No email prompts required.
        </p>
    </div>
    
    <p style="color: rgba(255,255,255,0.8); font-size: 14px; margin-top: 20px; font-style: italic;">
        🔒 Secure • 🌟 Personalized • 📱 Mobile-Friendly
    </p>
</div>

<script>
console.log('🚀 SEAMLESS URL PARAMETER - No prompts required');

function seamlessLogin() {
    console.log('🚀 Starting seamless login...');
    
    var baseUrl = 'https://ibam-learn-platform-v3.vercel.app';
    var secretToken = 'ibam-systeme-secret-2025';
    var userEmail = null;
    
    // METHOD 1: Check URL parameters first (most reliable)
    var urlParams = new URLSearchParams(window.location.search);
    userEmail = urlParams.get('email') || urlParams.get('user_email') || urlParams.get('contact_email');
    
    if (userEmail) {
        console.log('✅ Email found in URL parameter:', userEmail);
    } else {
        // METHOD 2: Check for email in current page URL hash
        if (window.location.hash) {
            var hashParams = new URLSearchParams(window.location.hash.substring(1));
            userEmail = hashParams.get('email') || hashParams.get('user_email');
            if (userEmail) {
                console.log('✅ Email found in URL hash:', userEmail);
            }
        }
    }
    
    // METHOD 3: Check stored email from previous session
    if (!userEmail) {
        userEmail = localStorage.getItem('ibam-auth-email');
        if (userEmail) {
            console.log('✅ Email found in localStorage:', userEmail);
        }
    }
    
    // METHOD 4: Extract email from page content
    if (!userEmail) {
        var pageText = document.body.innerText || document.body.textContent || '';
        var emailRegex = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g;
        var emails = pageText.match(emailRegex);
        
        if (emails && emails.length > 0) {
            // Filter out common system emails
            var userEmails = emails.filter(function(email) {
                return !email.toLowerCase().includes('support@') && 
                       !email.toLowerCase().includes('noreply@') && 
                       !email.toLowerCase().includes('info@') &&
                       !email.toLowerCase().includes('admin@') &&
                       !email.toLowerCase().includes('hello@') &&
                       !email.toLowerCase().includes('contact@');
            });
            
            if (userEmails.length > 0) {
                userEmail = userEmails[0];
                console.log('✅ Email extracted from page:', userEmail);
            }
        }
    }
    
    // If still no email found, show error (don't prompt)
    if (!userEmail) {
        console.log('❌ No email detected automatically');
        alert('Unable to detect your email automatically. Please contact support@ibam.org for assistance accessing your course.');
        return;
    }
    
    console.log('🎯 Using email for seamless login:', userEmail);
    
    // Clear any conflicting data
    localStorage.removeItem('ibam-auth-email');
    var authCookies = ['ibam_auth', 'ibam_auth_server'];
    authCookies.forEach(function(cookieName) {
        document.cookie = cookieName + '=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    });
    
    // Store the detected email
    localStorage.setItem('ibam-auth-email', userEmail);
    
    // Create login URL
    var loginUrl = baseUrl + '/api/auth/sso?email=' + encodeURIComponent(userEmail) + 
                   '&token=' + secretToken + 
                   '&source=seamless-url';
    
    console.log('🔗 Seamless login URL:', loginUrl);
    
    // Update button
    var button = document.getElementById('accessBtn');
    var originalText = button.innerHTML;
    button.innerHTML = '<span style="margin-right: 12px; font-size: 24px;">⏳</span><span>Opening Course...</span>';
    button.disabled = true;
    
    // Execute seamless login
    try {
        var courseWindow = window.open(loginUrl, '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes,toolbar=yes,location=yes');
        
        if (courseWindow) {
            courseWindow.focus();
            console.log('✅ Seamless login successful');
        } else {
            console.log('❌ Popup blocked, redirecting same window');
            window.location.href = loginUrl;
        }
        
    } catch (error) {
        console.log('❌ Error during seamless login:', error);
        window.location.href = loginUrl;
    }
    
    // Reset button
    setTimeout(function() {
        if (button) {
            button.innerHTML = originalText;
            button.disabled = false;
        }
    }, 3000);
}

// Page load detection
window.addEventListener('load', function() {
    console.log('🚀 SEAMLESS URL PARAMETER LOADED');
    console.log('===============================');
    
    // Show what parameters are available
    var urlParams = new URLSearchParams(window.location.search);
    var allParams = {};
    urlParams.forEach(function(value, key) {
        allParams[key] = value;
    });
    
    console.log('📍 Available URL parameters:', allParams);
    
    // Check for email parameter
    var emailParam = urlParams.get('email') || urlParams.get('user_email') || urlParams.get('contact_email');
    if (emailParam) {
        console.log('✅ Email parameter detected:', emailParam);
        console.log('🎯 Ready for seamless login');
    } else {
        console.log('⚠️ No email parameter found - will try other methods');
    }
    
    // Check stored email
    var storedEmail = localStorage.getItem('ibam-auth-email');
    if (storedEmail) {
        console.log('📝 Stored email available:', storedEmail);
    }
});
</script>