<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); margin: 20px auto; max-width: 500px; text-align: center; font-family: Arial, sans-serif;">
    
    <div style="background: rgba(0,255,0,0.2); color: #00ff00; padding: 8px 16px; border-radius: 20px; font-size: 12px; margin-bottom: 20px; border: 1px solid rgba(0,255,0,0.3);">
        ‚ö° Instant Access - No Login Required
    </div>
    
    <h1 style="color: white; font-size: 28px; font-weight: bold; margin-bottom: 16px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
        üéØ Welcome to IBAM Learning Platform
    </h1>
    
    <p style="color: rgba(255,255,255,0.9); font-size: 18px; margin-bottom: 32px; line-height: 1.5;">
        Your faith-driven business mastery course is ready!
    </p>
    
    <div style="margin: 24px 0; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 12px; border: 1px solid rgba(255,255,255,0.2);">
        <h3 style="color: white; margin: 0 0 12px 0; font-size: 18px;">üìö What You'll Access:</h3>
        <ul style="color: rgba(255,255,255,0.9); text-align: left; margin: 0; padding-left: 20px; line-height: 1.6;">
            <li>Complete IBAM Impact Member Training</li>
            <li>Interactive modules and assessments</li>
            <li>Business planning tools & templates</li>
            <li>AI-powered coaching assistance</li>
            <li>Progress tracking & certificates</li>
        </ul>
    </div>
    
    <!-- Email input section -->
    <div id="ibam-email-section" style="margin: 20px 0;">
        <p style="color: white; margin-bottom: 12px; font-size: 16px;">üìß Enter your email to access your course:</p>
        <input type="email" 
               id="ibam-email-input" 
               placeholder="your-email@example.com"
               style="padding: 12px 16px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 16px; width: 300px; margin: 8px 0; text-align: center;">
    </div>
    
    <button id="ibam-access-btn" 
            style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4); color: white; border: none; padding: 18px 36px; font-size: 22px; font-weight: bold; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 20px rgba(0,0,0,0.2); text-decoration: none; display: inline-block; min-width: 240px;">
        <span style="margin-right: 12px; font-size: 24px;">üöÄ</span>
        <span id="ibam-btn-text">Start Learning Now</span>
    </button>
    
    <div style="margin-top: 24px; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 8px; border-left: 4px solid #4ecdc4;">
        <p style="color: white; margin: 0; font-size: 14px; font-weight: bold;">‚ú® How It Works:</p>
        <p style="color: rgba(255,255,255,0.9); margin: 8px 0 0 0; font-size: 13px; line-height: 1.4;">
            Enter your email and click the button above to be instantly logged into your personal learning dashboard!
        </p>
    </div>
    
    <p style="color: rgba(255,255,255,0.8); font-size: 14px; margin-top: 20px; font-style: italic;">
        üîí Secure ‚Ä¢ üåü Personalized ‚Ä¢ üì± Mobile-Friendly
    </p>
    
    <div id="ibam-error-msg" style="display: none; background: rgba(255,0,0,0.2); color: #ff6666; padding: 12px; border-radius: 8px; margin-top: 16px; font-size: 14px; border: 1px solid rgba(255,0,0,0.3);">
    </div>
</div>

<script>
(function() {
    'use strict';
    
    console.log('üöÄ IBAM access button initializing...');
    
    // Wait for DOM to be ready
    function initIbamButton() {
        var button = document.getElementById('ibam-access-btn');
        var buttonText = document.getElementById('ibam-btn-text');
        var emailInput = document.getElementById('ibam-email-input');
        var errorMsg = document.getElementById('ibam-error-msg');
        
        if (!button || !buttonText || !emailInput || !errorMsg) {
            console.log('‚è≥ Waiting for IBAM elements...');
            setTimeout(initIbamButton, 100);
            return;
        }
        
        console.log('‚úÖ IBAM button ready');
        
        button.onclick = function() {
            console.log('üéØ IBAM button clicked');
            
            var userEmail = emailInput.value.trim();
            
            // Hide error
            errorMsg.style.display = 'none';
            
            if (!userEmail) {
                errorMsg.textContent = 'Please enter your email address';
                errorMsg.style.display = 'block';
                return;
            }
            
            if (!userEmail.includes('@') || !userEmail.includes('.')) {
                errorMsg.textContent = 'Please enter a valid email address';
                errorMsg.style.display = 'block';
                return;
            }
            
            // Disable button
            button.disabled = true;
            button.style.opacity = '0.7';
            buttonText.textContent = 'Getting Access...';
            
            console.log('üîç Getting access for:', userEmail);
            
            // Create request URL
            var tokenUrl = 'https://ibam-learn-platform-v3.vercel.app/api/auth/get-magic-token?email=' + encodeURIComponent(userEmail);
            
            // Make request using fetch or fallback to XMLHttpRequest
            if (typeof fetch !== 'undefined') {
                fetch(tokenUrl)
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Access not found. Please ensure you have purchased a course.');
                        }
                        return response.json();
                    })
                    .then(function(data) {
                        if (!data.success || !data.token) {
                            throw new Error(data.message || 'Access token not found');
                        }
                        
                        console.log('‚úÖ Token received, opening platform...');
                        buttonText.textContent = 'Opening Platform...';
                        
                        var accessUrl = 'https://ibam-learn-platform-v3.vercel.app/api/auth/magic-token?token=' + data.token;
                        var newWindow = window.open(accessUrl, '_blank', 'noopener,noreferrer');
                        
                        if (!newWindow) {
                            throw new Error('Popup blocked! Please allow popups and try again.');
                        }
                        
                        buttonText.textContent = 'Platform Opened!';
                        
                        setTimeout(function() {
                            button.disabled = false;
                            button.style.opacity = '1';
                            buttonText.textContent = 'Start Learning Now';
                        }, 3000);
                    })
                    .catch(function(error) {
                        console.error('‚ùå Access failed:', error);
                        errorMsg.textContent = error.message;
                        errorMsg.style.display = 'block';
                        
                        button.disabled = false;
                        button.style.opacity = '1';
                        buttonText.textContent = 'Start Learning Now';
                    });
            } else {
                // Fallback for older browsers
                var xhr = new XMLHttpRequest();
                xhr.open('GET', tokenUrl, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            try {
                                var data = JSON.parse(xhr.responseText);
                                if (data.success && data.token) {
                                    var accessUrl = 'https://ibam-learn-platform-v3.vercel.app/api/auth/magic-token?token=' + data.token;
                                    window.open(accessUrl, '_blank');
                                    buttonText.textContent = 'Platform Opened!';
                                } else {
                                    throw new Error(data.message || 'Access not found');
                                }
                            } catch (e) {
                                errorMsg.textContent = 'Access not found. Please check your email.';
                                errorMsg.style.display = 'block';
                            }
                        } else {
                            errorMsg.textContent = 'Access not found. Please ensure you have purchased a course.';
                            errorMsg.style.display = 'block';
                        }
                        
                        button.disabled = false;
                        button.style.opacity = '1';
                        buttonText.textContent = 'Start Learning Now';
                    }
                };
                xhr.send();
            }
        };
        
        // Add hover effect
        button.onmouseover = function() {
            if (!button.disabled) {
                button.style.transform = 'translateY(-3px)';
                button.style.boxShadow = '0 12px 25px rgba(0,0,0,0.3)';
            }
        };
        
        button.onmouseout = function() {
            if (!button.disabled) {
                button.style.transform = 'translateY(0)';
                button.style.boxShadow = '0 8px 20px rgba(0,0,0,0.2)';
            }
        };
        
        // Enter key support
        emailInput.onkeypress = function(e) {
            if (e.key === 'Enter' || e.keyCode === 13) {
                button.click();
            }
        };
    }
    
    // Initialize when ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initIbamButton);
    } else {
        initIbamButton();
    }
})();
</script>