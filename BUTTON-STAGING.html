<!DOCTYPE html>
<html>
<head>
    <title>IBAM Learning Platform - Staging Access</title>
    <style>
        .staging-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .staging-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .staging-banner {
            background: #ff9800;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="staging-banner">
        üöß STAGING ENVIRONMENT - FOR TESTING ONLY üöß
    </div>
    
    <div style="text-align: center; padding: 50px;">
        <h1>IBAM Learning Platform - Staging</h1>
        <p>Test your System.io integration safely</p>
        
        <button class="staging-button" onclick="accessIBAMStaging()">
            Access IBAM Learning Platform (Staging)
        </button>
    </div>

    <script>
        function accessIBAMStaging() {
            console.log('üöß Staging: Accessing IBAM Learning Platform...');
            
            // Enhanced email detection - try multiple methods
            var userEmail = '';
            
            // Method 1: Check URL parameters first
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('email')) {
                userEmail = urlParams.get('email');
                console.log('üìß Email from URL parameter:', userEmail);
            }
            
            // Method 2: Try to get from SystemeIO (if available)
            else if (typeof window.parent !== 'undefined' && window.parent.SystemeIO) {
                try {
                    userEmail = window.parent.SystemeIO.user.email || '';
                    console.log('üìß Email from SystemeIO:', userEmail);
                } catch (e) {
                    console.log('‚ö†Ô∏è Could not access SystemeIO user data');
                }
            }
            
            // Method 3: Check localStorage
            else if (localStorage.getItem('user_email')) {
                userEmail = localStorage.getItem('user_email');
                console.log('üìß Email from localStorage:', userEmail);
            }
            
            // Method 4: Prompt user if no email found
            if (!userEmail) {
                userEmail = prompt('Please enter your email for staging access:');
                if (!userEmail) {
                    alert('Email is required for staging access');
                    return;
                }
            }
            
            // STAGING URL - Points to staging deployment
            var ssoUrl = 'https://ibam-learning-staging.vercel.app/api/auth/sso?email=' + encodeURIComponent(userEmail) + '&token=ibam-systeme-secret-2025';
            
            console.log('üöß Staging SSO URL:', ssoUrl);
            console.log('üìß User email:', userEmail);
            
            // Open in new window for staging testing
            window.open(ssoUrl, '_blank', 'noopener,noreferrer');
        }
    </script>
</body>
</html>